<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>IS415-GAA - Take home assignment 2 - Glenn</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on-Ex02.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on-Ex03.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on-Ex04.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on-Ex06.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on-Ex07.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on-Ex08.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09/Hands-on-Ex09.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on-Ex10.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">In class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../in-class_Ex/In-class_Ex02/In-class_Ex02.html" rel="" target="">
 <span class="dropdown-text">In class exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_Ex/In-class-Ex03/In-class_Ex03.html" rel="" target="">
 <span class="dropdown-text">In class exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_Ex/In-class-Ex03/In-class_Ex03-NKDE.html" rel="" target="">
 <span class="dropdown-text">In class exercise 3.2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_Ex/In-class_Ex04/In-class_Ex04.html" rel="" target="">
 <span class="dropdown-text">In class exercise 4.1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_Ex/In-class_Ex05/In-class_Ex05.html" rel="" target="">
 <span class="dropdown-text">In class exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_Ex/In-class_Ex07/In-class_Ex07.html" rel="" target="">
 <span class="dropdown-text">In class exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_Ex/In-class_Ex08/In-class_Ex08.html" rel="" target="">
 <span class="dropdown-text">In class exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_Ex/In-class_Ex09/In-class_Ex09.html" rel="" target="">
 <span class="dropdown-text">In class exercise 9</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Take home exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../take_home_Ex/take_home_Ex_01/take_home_Ex_01.html" rel="" target="">
 <span class="dropdown-text">Take home exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../take_home_Ex/take_home_Ex_02/take_home_Ex02.html" rel="" target="">
 <span class="dropdown-text">Take home exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-task" id="toc-the-task" class="nav-link active" data-scroll-target="#the-task">1.0 The Task</a></li>
  <li><a href="#importing-the-packages" id="toc-importing-the-packages" class="nav-link" data-scroll-target="#importing-the-packages">2.0 Importing the packages</a></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">3.0 Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#importing-the-data-tainan" id="toc-importing-the-data-tainan" class="nav-link" data-scroll-target="#importing-the-data-tainan">3.1 Importing the data (Tainan)</a></li>
  <li><a href="#importing-the-data-dengue-daily" id="toc-importing-the-data-dengue-daily" class="nav-link" data-scroll-target="#importing-the-data-dengue-daily">3.2 Importing the data (Dengue Daily)</a></li>
  <li><a href="#making-the-list-of-towns-required---found-in-assignment-brief" id="toc-making-the-list-of-towns-required---found-in-assignment-brief" class="nav-link" data-scroll-target="#making-the-list-of-towns-required---found-in-assignment-brief">3.3 Making the list of towns required - Found in assignment brief</a></li>
  <li><a href="#filtering-tainan-villages-based-on-the-above-list" id="toc-filtering-tainan-villages-based-on-the-above-list" class="nav-link" data-scroll-target="#filtering-tainan-villages-based-on-the-above-list">3.3.1 Filtering tainan villages based on the above list</a></li>
  <li><a href="#filtering-dengue-dataset-to-only-fall-between-epidemiology-week-31-50-2023." id="toc-filtering-dengue-dataset-to-only-fall-between-epidemiology-week-31-50-2023." class="nav-link" data-scroll-target="#filtering-dengue-dataset-to-only-fall-between-epidemiology-week-31-50-2023.">3.4 Filtering dengue dataset to only fall between epidemiology week 31-50, 2023.</a>
  <ul class="collapse">
  <li><a href="#changing-first-column-to-transmit-date---easier" id="toc-changing-first-column-to-transmit-date---easier" class="nav-link" data-scroll-target="#changing-first-column-to-transmit-date---easier">3.4.1 Changing first column to transmit date - easier</a></li>
  <li><a href="#changing-column-type-to-date" id="toc-changing-column-type-to-date" class="nav-link" data-scroll-target="#changing-column-type-to-date">3.4.2 Changing column type to date</a></li>
  <li><a href="#filtering-for-week-31---50" id="toc-filtering-for-week-31---50" class="nav-link" data-scroll-target="#filtering-for-week-31---50">3.4.3 Filtering for week 31 - 50</a></li>
  <li><a href="#only-keeping-date-transmit-lat-and-long-and-week_number" id="toc-only-keeping-date-transmit-lat-and-long-and-week_number" class="nav-link" data-scroll-target="#only-keeping-date-transmit-lat-and-long-and-week_number">3.4.4 Only keeping date transmit , lat and long and week_number</a></li>
  </ul></li>
  <li><a href="#joining-the-data-of-filtered-village-and-dengue" id="toc-joining-the-data-of-filtered-village-and-dengue" class="nav-link" data-scroll-target="#joining-the-data-of-filtered-village-and-dengue">3.5 Joining the data of filtered village and dengue</a>
  <ul class="collapse">
  <li><a href="#changing-class-from-character-to-numeric" id="toc-changing-class-from-character-to-numeric" class="nav-link" data-scroll-target="#changing-class-from-character-to-numeric">3.5.1 Changing class from character to numeric</a></li>
  <li><a href="#removing-na-values" id="toc-removing-na-values" class="nav-link" data-scroll-target="#removing-na-values">3.5.2 Removing NA Values</a></li>
  <li><a href="#transforming-from-decimal-point-to-3824" id="toc-transforming-from-decimal-point-to-3824" class="nav-link" data-scroll-target="#transforming-from-decimal-point-to-3824">3.5.3 Transforming from decimal point to 3824</a></li>
  </ul></li>
  <li><a href="#finding-the-intercept" id="toc-finding-the-intercept" class="nav-link" data-scroll-target="#finding-the-intercept">3.6 Finding the intercept</a>
  <ul class="collapse">
  <li><a href="#making-it-a-union-so-that-finding-points-within-this-union-is-faster" id="toc-making-it-a-union-so-that-finding-points-within-this-union-is-faster" class="nav-link" data-scroll-target="#making-it-a-union-so-that-finding-points-within-this-union-is-faster">3.6.1 Making it a union so that finding points within this union is faster</a></li>
  <li><a href="#intersection" id="toc-intersection" class="nav-link" data-scroll-target="#intersection">3.6.2 Intersection</a></li>
  <li><a href="#finding-points-that-fall-within-the-different-vilages-concetenating-townid-and-vill-eng" id="toc-finding-points-that-fall-within-the-different-vilages-concetenating-townid-and-vill-eng" class="nav-link" data-scroll-target="#finding-points-that-fall-within-the-different-vilages-concetenating-townid-and-vill-eng">3.6.3 Finding points that fall within the different vilages, concetenating TOWNID and VILL ENG</a></li>
  <li><a href="#write-to-rds" id="toc-write-to-rds" class="nav-link" data-scroll-target="#write-to-rds">3.6.4 Write to RDS</a></li>
  <li><a href="#read-from-rds" id="toc-read-from-rds" class="nav-link" data-scroll-target="#read-from-rds">3.6.5 Read from RDS</a></li>
  <li><a href="#we-only-select-the-required-fields-which-are-week-number-town-and-transmit-date" id="toc-we-only-select-the-required-fields-which-are-week-number-town-and-transmit-date" class="nav-link" data-scroll-target="#we-only-select-the-required-fields-which-are-week-number-town-and-transmit-date">3.6.5 We only select the required fields which are Week number, town and transmit date</a></li>
  </ul></li>
  <li><a href="#plots" id="toc-plots" class="nav-link" data-scroll-target="#plots">3.7 Plots</a></li>
  <li><a href="#joining-the-2-datasets-together" id="toc-joining-the-2-datasets-together" class="nav-link" data-scroll-target="#joining-the-2-datasets-together">3.8 Joining the 2 datasets together</a></li>
  <li><a href="#calculating-frequency" id="toc-calculating-frequency" class="nav-link" data-scroll-target="#calculating-frequency">3.9 Calculating frequency</a>
  <ul class="collapse">
  <li><a href="#joining-the-data" id="toc-joining-the-data" class="nav-link" data-scroll-target="#joining-the-data">3.9.2 Joining the data</a></li>
  <li><a href="#visualising-regional-development-indicator" id="toc-visualising-regional-development-indicator" class="nav-link" data-scroll-target="#visualising-regional-development-indicator">3.9.3 Visualising Regional Development Indicator</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#global-measures-of-spatial-autocorrelation" id="toc-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation">4 Global Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#computing-wm_q-and-writing-to-rds" id="toc-computing-wm_q-and-writing-to-rds" class="nav-link" data-scroll-target="#computing-wm_q-and-writing-to-rds">4.1 Computing wm_q and writing to rds</a></li>
  <li><a href="#morans-test" id="toc-morans-test" class="nav-link" data-scroll-target="#morans-test">4.2 Morans test</a>
  <ul class="collapse">
  <li><a href="#visualising-monte-carlo-morans-test" id="toc-visualising-monte-carlo-morans-test" class="nav-link" data-scroll-target="#visualising-monte-carlo-morans-test">4.2.2 Visualising Monte-carlo moran’s test</a></li>
  <li><a href="#geary-c" id="toc-geary-c" class="nav-link" data-scroll-target="#geary-c">4.2.3 Geary C</a></li>
  <li><a href="#compute-moran-correlogram" id="toc-compute-moran-correlogram" class="nav-link" data-scroll-target="#compute-moran-correlogram">4.2.4 Compute Moran correlogram</a></li>
  <li><a href="#compute-geary-c-correlogram" id="toc-compute-geary-c-correlogram" class="nav-link" data-scroll-target="#compute-geary-c-correlogram">4.2.5 Compute geary C correlogram</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#local-measures-of-spatial-autocorrelation-cluster-and-outlier-analysis" id="toc-local-measures-of-spatial-autocorrelation-cluster-and-outlier-analysis" class="nav-link" data-scroll-target="#local-measures-of-spatial-autocorrelation-cluster-and-outlier-analysis">5 Local Measures of Spatial Autocorrelation (Cluster and Outlier Analysis)</a>
  <ul class="collapse">
  <li><a href="#local-moran" id="toc-local-moran" class="nav-link" data-scroll-target="#local-moran">5.1 Local moran</a>
  <ul class="collapse">
  <li><a href="#joining-local-moran-results-and-wm_q" id="toc-joining-local-moran-results-and-wm_q" class="nav-link" data-scroll-target="#joining-local-moran-results-and-wm_q">5.1.1 joining Local moran results and wm_q</a></li>
  <li><a href="#mapping-local-moran" id="toc-mapping-local-moran" class="nav-link" data-scroll-target="#mapping-local-moran">5.1.2 Mapping local moran</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#hot-spot-and-cold-spot-area-analysis" id="toc-hot-spot-and-cold-spot-area-analysis" class="nav-link" data-scroll-target="#hot-spot-and-cold-spot-area-analysis">6.0 Hot Spot and Cold Spot Area Analysis</a>
  <ul class="collapse">
  <li><a href="#calculating-the-local-gi" id="toc-calculating-the-local-gi" class="nav-link" data-scroll-target="#calculating-the-local-gi">6.1 Calculating the local Gi*</a></li>
  <li><a href="#mapping-local-gi" id="toc-mapping-local-gi" class="nav-link" data-scroll-target="#mapping-local-gi">6.2 Mapping local Gi*</a></li>
  </ul></li>
  <li><a href="#space-time-and-space-cubes" id="toc-space-time-and-space-cubes" class="nav-link" data-scroll-target="#space-time-and-space-cubes">7 Space time and space cubes</a>
  <ul class="collapse">
  <li><a href="#filtering-data-that-we-need" id="toc-filtering-data-that-we-need" class="nav-link" data-scroll-target="#filtering-data-that-we-need">7.1 Filtering data that we need</a></li>
  <li><a href="#creating-a-space-time-object" id="toc-creating-a-space-time-object" class="nav-link" data-scroll-target="#creating-a-space-time-object">7.2 Creating a space time object</a>
  <ul class="collapse">
  <li><a href="#spacetime-contexts" id="toc-spacetime-contexts" class="nav-link" data-scroll-target="#spacetime-contexts">7.2.1 Spacetime Contexts</a></li>
  <li><a href="#replacing-all-n.a-values-with-0" id="toc-replacing-all-n.a-values-with-0" class="nav-link" data-scroll-target="#replacing-all-n.a-values-with-0">7.3.2 Replacing all N.A values with 0</a></li>
  </ul></li>
  <li><a href="#emerging-hotspot-analysis" id="toc-emerging-hotspot-analysis" class="nav-link" data-scroll-target="#emerging-hotspot-analysis">7.4 Emerging hotspot analysis</a></li>
  <li><a href="#emerging-hotspot-analysis-1" id="toc-emerging-hotspot-analysis-1" class="nav-link" data-scroll-target="#emerging-hotspot-analysis-1">7.5 Emerging hotspot analysis</a>
  <ul class="collapse">
  <li><a href="#visualising-the-distribution-of-ehsa-classes" id="toc-visualising-the-distribution-of-ehsa-classes" class="nav-link" data-scroll-target="#visualising-the-distribution-of-ehsa-classes">7.5.1 Visualising the distribution of EHSA classes</a></li>
  </ul></li>
  <li><a href="#visualising-ehsa" id="toc-visualising-ehsa" class="nav-link" data-scroll-target="#visualising-ehsa">7.6 Visualising EHSA</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take home assignment 2 - Glenn</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Invalid Date</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="the-task" class="level1">
<h1>1.0 The Task</h1>
<p>The specific tasks of this take-home exercise are as follows:</p>
<p>-Using appropriate function of sf and tidyverse, preparing the following geospatial data layer: 1. a study area layer in sf polygon features. It must be at village level and confined to the D01, D02, D04, D06, D07, D08, D32 and D39 counties of Tainan City, Taiwan. 2. a dengue fever layer within the study area in sf point features. The dengue fever cases should be confined to epidemiology week 31-50, 2023. 3. a derived dengue fever layer in spacetime s3 class of sfdep. It should contain, among many other useful information, a data field showing number of dengue fever cases by village and by epidemiology week.</p>
<p>-Using the extracted data, perform global spatial autocorrelation analysis by using sfdep methods. -Using the extracted data, perform local spatial autocorrelation analysis by using sfdep methods. -Using the extracted data, perform emerging hotspot analysis by using sfdep methods. -Describe the spatial patterns revealed by the analysis above.</p>
</section>
<section id="importing-the-packages" class="level1">
<h1>2.0 Importing the packages</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, sfdep, tmap, plotly, tidyverse,spdep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-wrangling" class="level1">
<h1>3.0 Data Wrangling</h1>
<section id="importing-the-data-tainan" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-data-tainan">3.1 Importing the data (Tainan)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tainan <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">layer =</span> <span class="st">"TAINAN_VILLAGE"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3824</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `TAINAN_VILLAGE' from data source 
  `C:\FieryCake\IS415-GAA\take_home_Ex\take_home_Ex_02\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 649 features and 10 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 120.0269 ymin: 22.88751 xmax: 120.6563 ymax: 23.41374
Geodetic CRS:  TWD97</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(tainan))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We plot the map of tainan and see that it is not the same as shown in class. This is because it includes all the regions and tainan. We have to filter the dataset accordingly in later code so that we get the correct area.</p>
</div>
</div>
</section>
<section id="importing-the-data-dengue-daily" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-data-dengue-daily">3.2 Importing the data (Dengue Daily)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dengue <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/Dengue_Daily.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="making-the-list-of-towns-required---found-in-assignment-brief" class="level2">
<h2 class="anchored" data-anchor-id="making-the-list-of-towns-required---found-in-assignment-brief">3.3 Making the list of towns required - Found in assignment brief</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>town_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"D01"</span>,<span class="st">"D02"</span>,<span class="st">"D04"</span>,<span class="st">"D06"</span>,<span class="st">"D07"</span>,<span class="st">"D08"</span>,<span class="st">"D32"</span>,<span class="st">"D39"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>town_ids is a list of towns, as mentioned in the assignment brief on the website</p>
</div>
</div>
</section>
<section id="filtering-tainan-villages-based-on-the-above-list" class="level2">
<h2 class="anchored" data-anchor-id="filtering-tainan-villages-based-on-the-above-list">3.3.1 Filtering tainan villages based on the above list</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tainan_filtered_villages <span class="ot">&lt;-</span> tainan <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOWNID <span class="sc">%in%</span> town_ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We then filter our dataset to only include those towns that are provided in the list</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tainan_filtered_villages</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 258 features and 10 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 120.0627 ymin: 22.89401 xmax: 120.2925 ymax: 23.09144
Geodetic CRS:  TWD97
First 10 features:
      VILLCODE COUNTYNAME TOWNNAME VILLNAME       VILLENG COUNTYID COUNTYCODE
1  67000350032     臺南市   安南區   青草里  Qingcao Vil.        D      67000
2  67000270011     臺南市   仁德區   保安里   Bao'an Vil.        D      67000
3  67000370005     臺南市   中西區   赤嵌里  Chihkan Vil.        D      67000
4  67000330004     臺南市     南區   大成里  Dacheng Vil.        D      67000
5  67000350028     臺南市   安南區   城北里 Chengbei Vil.        D      67000
6  67000350030     臺南市   安南區   城南里 Chengnan Vil.        D      67000
7  67000370009     臺南市   中西區   法華里    Fahua Vil.        D      67000
8  67000350017     臺南市   安南區   海南里   Hainan Vil.        D      67000
9  67000350049     臺南市   安南區   國安里   Guo'an Vil.        D      67000
10 67000350018     臺南市   安南區   溪心里    Xixin Vil.        D      67000
   TOWNID TOWNCODE NOTE                       geometry
1     D06 67000350 &lt;NA&gt; POLYGON ((120.1176 23.08387...
2     D32 67000270 &lt;NA&gt; POLYGON ((120.2304 22.93544...
3     D08 67000370 &lt;NA&gt; POLYGON ((120.2012 22.99966...
4     D02 67000330 &lt;NA&gt; POLYGON ((120.1985 22.98147...
5     D06 67000350 &lt;NA&gt; POLYGON ((120.1292 23.06512...
6     D06 67000350 &lt;NA&gt; POLYGON ((120.1246 23.06904...
7     D08 67000370 &lt;NA&gt; POLYGON ((120.2094 22.98452...
8     D06 67000350 &lt;NA&gt; POLYGON ((120.175 23.02218,...
9     D06 67000350 &lt;NA&gt; POLYGON ((120.1866 23.02766...
10    D06 67000350 &lt;NA&gt; POLYGON ((120.1834 23.06086...</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We then plot out the map to see if the area is the same as shown in class</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(tainan_filtered_villages))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>After filtering the dataset, we can see that the plot is indeed the same as the one shown in class.</p>
</div>
</div>
</section>
<section id="filtering-dengue-dataset-to-only-fall-between-epidemiology-week-31-50-2023." class="level2">
<h2 class="anchored" data-anchor-id="filtering-dengue-dataset-to-only-fall-between-epidemiology-week-31-50-2023.">3.4 Filtering dengue dataset to only fall between epidemiology week 31-50, 2023.</h2>
<section id="changing-first-column-to-transmit-date---easier" class="level3">
<h3 class="anchored" data-anchor-id="changing-first-column-to-transmit-date---easier">3.4.1 Changing first column to transmit date - easier</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dengue)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"transmit_date"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="changing-column-type-to-date" class="level3">
<h3 class="anchored" data-anchor-id="changing-column-type-to-date">3.4.2 Changing column type to date</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dengue<span class="sc">$</span>transmit_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(dengue<span class="sc">$</span>transmit_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-for-week-31---50" class="level3">
<h3 class="anchored" data-anchor-id="filtering-for-week-31---50">3.4.3 Filtering for week 31 - 50</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Epidemoiology weeks source- https://www.hpsc.ie/notifiablediseases/resources/epidemiologicalweeks/</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dengue_filtered <span class="ot">&lt;-</span> dengue <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">between</span>(transmit_date, <span class="fu">as.Date</span>(<span class="st">'2023-07-30'</span>), <span class="fu">as.Date</span>(<span class="st">'2023-12-16'</span>)))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>dengue_filtered<span class="sc">$</span>week_number <span class="ot">&lt;-</span> <span class="fu">week</span>(dengue_filtered<span class="sc">$</span>transmit_date) <span class="sc">-</span> <span class="fu">week</span>(<span class="st">'2023-07-30'</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dengue_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 27
  transmit_date 個案研判日 通報日     性別  年齡層 居住縣市 居住鄉鎮 居住村里
  &lt;date&gt;        &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
1 2023-07-30    2023/07/31 2023-07-31 女    65-69  台南市   東區     忠孝里  
2 2023-07-30    2023/07/31 2023-07-31 男    70+    台南市   東區     德光里  
3 2023-07-30    2023/07/31 2023-07-31 女    50-54  台南市   永康區   五王里  
4 2023-07-30    2023/07/31 2023-07-31 女    15-19  台南市   永康區   二王里  
5 2023-07-30    2023/07/31 2023-07-31 女    15-19  台南市   永康區   二王里  
6 2023-07-30    2023/08/02 2023-08-02 男    50-54  台南市   永康區   安康里  
# ℹ 19 more variables: 最小統計區 &lt;chr&gt;, 最小統計區中心點X &lt;chr&gt;,
#   最小統計區中心點Y &lt;chr&gt;, 一級統計區 &lt;chr&gt;, 二級統計區 &lt;chr&gt;,
#   感染縣市 &lt;chr&gt;, 感染鄉鎮 &lt;chr&gt;, 感染村里 &lt;chr&gt;, 是否境外移入 &lt;chr&gt;,
#   感染國家 &lt;chr&gt;, 確定病例數 &lt;dbl&gt;, 居住村里代碼 &lt;chr&gt;, 感染村里代碼 &lt;chr&gt;,
#   血清型 &lt;chr&gt;, 內政部居住縣市代碼 &lt;chr&gt;, 內政部居住鄉鎮代碼 &lt;chr&gt;,
#   內政部感染縣市代碼 &lt;chr&gt;, 內政部感染鄉鎮代碼 &lt;chr&gt;, week_number &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="only-keeping-date-transmit-lat-and-long-and-week_number" class="level3">
<h3 class="anchored" data-anchor-id="only-keeping-date-transmit-lat-and-long-and-week_number">3.4.4 Only keeping date transmit , lat and long and week_number</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dengue_filtered <span class="ot">&lt;-</span> <span class="fu">select</span>(dengue_filtered,<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">27</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dengue_filtered)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"lng"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dengue_filtered)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"lat"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(tainan_filtered_villages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:3824 
  wkt:
GEOGCRS["TWD97",
    DATUM["Taiwan Datum 1997",
        ELLIPSOID["GRS 1980",6378137,298.257222101,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["Taiwan, Republic of China - onshore and offshore - Taiwan Island, Penghu (Pescadores) Islands."],
        BBOX[17.36,114.32,26.96,123.61]],
    ID["EPSG",3824]]</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We check the CRS of our dataset to see if it is correct. Correct CRS should be TWD97, not WSG84</p>
</div>
</div>
</section>
</section>
<section id="joining-the-data-of-filtered-village-and-dengue" class="level2">
<h2 class="anchored" data-anchor-id="joining-the-data-of-filtered-village-and-dengue">3.5 Joining the data of filtered village and dengue</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dengue_filtered</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25,475 × 4
   transmit_date lng           lat          week_number
   &lt;date&gt;        &lt;chr&gt;         &lt;chr&gt;              &lt;dbl&gt;
 1 2023-07-30    120.220182286 22.976075790           1
 2 2023-07-30    120.218036763 22.980068070           1
 3 2023-07-30    120.235449178 23.013736726           1
 4 2023-07-30    120.245579790 23.019322681           1
 5 2023-07-30    120.246524983 23.018206041           1
 6 2023-07-30    120.226597184 23.016947543           1
 7 2023-07-30    120.459990679 23.599175697           1
 8 2023-07-30    120.234949811 23.015998065           1
 9 2023-07-30    120.234949811 23.015998065           1
10 2023-07-30    120.247723767 23.011129228           1
# ℹ 25,465 more rows</code></pre>
</div>
</div>
<section id="changing-class-from-character-to-numeric" class="level3">
<h3 class="anchored" data-anchor-id="changing-class-from-character-to-numeric">3.5.1 Changing class from character to numeric</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dengue_filtered<span class="sc">$</span>lng <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dengue_filtered<span class="sc">$</span>lng)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>dengue_filtered<span class="sc">$</span>lat <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dengue_filtered<span class="sc">$</span>lat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="removing-na-values" class="level3">
<h3 class="anchored" data-anchor-id="removing-na-values">3.5.2 Removing NA Values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dengue_filtered_complete <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(dengue_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>NA Values are introduced and we have to remove them</p>
</div>
</div>
</section>
<section id="transforming-from-decimal-point-to-3824" class="level3">
<h3 class="anchored" data-anchor-id="transforming-from-decimal-point-to-3824">3.5.3 Transforming from decimal point to 3824</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sf_object <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(dengue_filtered_complete, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3824</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Looking at the lat and long, we know that the numbers are in decimal point degree. We have to tell R that it is in crs 4326 and we have to change it to 3824</p>
</div>
</div>
</section>
</section>
<section id="finding-the-intercept" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-intercept">3.6 Finding the intercept</h2>
<section id="making-it-a-union-so-that-finding-points-within-this-union-is-faster" class="level3">
<h3 class="anchored" data-anchor-id="making-it-a-union-so-that-finding-points-within-this-union-is-faster">3.6.1 Making it a union so that finding points within this union is faster</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>merged_polygon <span class="ot">&lt;-</span> <span class="fu">st_union</span>(tainan_filtered_villages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>First i make a union of all the villages</p>
<p>Next We check the classes of the objects to know what we are working with as seen below</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(merged_polygon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sfc_POLYGON" "sfc"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sf_object)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
</section>
<section id="intersection" class="level3">
<h3 class="anchored" data-anchor-id="intersection">3.6.2 Intersection</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>denguePointsInTainan <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(sf_object, merged_polygon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This one is to filter points found only in big polygon - it is faster than finding points in each polygon first</p>
</div>
</div>
</section>
<section id="finding-points-that-fall-within-the-different-vilages-concetenating-townid-and-vill-eng" class="level3">
<h3 class="anchored" data-anchor-id="finding-points-that-fall-within-the-different-vilages-concetenating-townid-and-vill-eng">3.6.3 Finding points that fall within the different vilages, concetenating TOWNID and VILL ENG</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>town_dengue_intersections <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(denguePointsInTainan, tainan_filtered_villages) <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">town =</span> <span class="fu">paste0</span>(<span class="fu">as.character</span>(TOWNID),<span class="st">" "</span>,<span class="fu">as.character</span>(VILLENG)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Comment: Finding intersection of each point mapped to each town Will need to push it into a rds as it takes very long to compute</p>
</div>
</div>
</section>
<section id="write-to-rds" class="level3">
<h3 class="anchored" data-anchor-id="write-to-rds">3.6.4 Write to RDS</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(town_dengue_intersections,<span class="st">"data/rds/town_dengue_intersections.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We can see from the map here that most of the points are located in the center.</p>
</div>
</div>
</section>
<section id="read-from-rds" class="level3">
<h3 class="anchored" data-anchor-id="read-from-rds">3.6.5 Read from RDS</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>town_dengue_intersections_rds <span class="ot">&lt;-</span><span class="fu">read_rds</span>(<span class="st">"data/rds/town_dengue_intersections.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="we-only-select-the-required-fields-which-are-week-number-town-and-transmit-date" class="level3">
<h3 class="anchored" data-anchor-id="we-only-select-the-required-fields-which-are-week-number-town-and-transmit-date">3.6.5 We only select the required fields which are Week number, town and transmit date</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>town_dengue_intersections_rds <span class="ot">&lt;-</span> <span class="fu">select</span>(town_dengue_intersections_rds,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="plots" class="level2">
<h2 class="anchored" data-anchor-id="plots">3.7 Plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(denguePointsInTainan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(tainan_filtered_villages) <span class="sc">+</span><span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(denguePointsInTainan) <span class="sc">+</span><span class="fu">tm_dots</span>()<span class="sc">+</span><span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">tm_scale_bar</span>()<span class="sc">+</span><span class="fu">tm_grid</span>(<span class="at">alpha=</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="joining-the-2-datasets-together" class="level2">
<h2 class="anchored" data-anchor-id="joining-the-2-datasets-together">3.8 Joining the 2 datasets together</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">st_drop_geometry</span>(town_dengue_intersections_rds)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"town"</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>tainan_filtered_villages <span class="ot">&lt;-</span> tainan_filtered_villages <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">town =</span> <span class="fu">paste0</span>(<span class="fu">as.character</span>(TOWNID), <span class="st">" "</span>, <span class="fu">as.character</span>(VILLENG)))</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>tainan_filtered_villages2<span class="ot">&lt;-</span><span class="fu">select</span>(tainan_filtered_villages,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">12</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df,tainan_filtered_villages2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Steps: First i drop the geometric points as i already have town (comprises of TOWNID and village eng) - to seperate village level</p>
<p>Next, i mutate tainan_filtered_village (Map) to combine TownID and village eng too</p>
<p>Left join the 2 data sets and filter those columns that i want</p>
<p>Joining these 2 will result in date transmitted, town, and other details like geometry etc.</p>
</div>
</div>
</section>
<section id="calculating-frequency" class="level2">
<h2 class="anchored" data-anchor-id="calculating-frequency">3.9 Calculating frequency</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>town_frequency <span class="ot">&lt;-</span> test2 <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">frequency =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>town_frequency2 <span class="ot">&lt;-</span> test2 <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town,week_number) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">frequency =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>What this does is to calculate the number of “frequency”. Frequency count will count number of cases there is a transmit date. We calculate frequency for town_frequency dataset (group only by town) and town_frequency2 (group by town and week number). Group by town and week number for spatio temporal while group by town will be for Global Measures of Spatial Autocorrelation</p>
</div>
</div>
<section id="joining-the-data" class="level3">
<h3 class="anchored" data-anchor-id="joining-the-data">3.9.2 Joining the data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>test3 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(test2, town_frequency)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>test4 <span class="ot">&lt;-</span><span class="fu">left_join</span>(test2,town_frequency2)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(test3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>unique_data <span class="ot">&lt;-</span> test3 <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(town, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>test3_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(unique_data)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>test4_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(test4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The end result of this join will be a dataset, each row indicating Week, town, number of transmit for that week for that town and the geometry</p>
</div>
</div>
</section>
<section id="visualising-regional-development-indicator" class="level3">
<h3 class="anchored" data-anchor-id="visualising-regional-development-indicator">3.9.3 Visualising Regional Development Indicator</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>equal <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(test3_sf) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"frequency"</span>,<span class="at">n=</span><span class="dv">5</span>,  <span class="at">style =</span> <span class="st">"equal"</span>) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span><span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">tm_scale_bar</span>()<span class="sc">+</span><span class="fu">tm_grid</span>(<span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Town Frequency"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>quantile<span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(test3_sf) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"frequency"</span>,<span class="at">n=</span><span class="dv">5</span>,  <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span><span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">tm_scale_bar</span>()<span class="sc">+</span><span class="fu">tm_grid</span>(<span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Town Frequency"</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(equal, </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>             quantile, </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">asp=</span><span class="dv">1</span>, </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Insight: What we can see here is that quantile frequency binning is more effective for visualizing frequency of transmit. Transmit frequency is very high in the ceter region of tainan</p>
</div>
</div>
</section>
</section>
</section>
<section id="global-measures-of-spatial-autocorrelation" class="level1">
<h1>4 Global Measures of Spatial Autocorrelation</h1>
<section id="computing-wm_q-and-writing-to-rds" class="level2">
<h2 class="anchored" data-anchor-id="computing-wm_q-and-writing-to-rds">4.1 Computing wm_q and writing to rds</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>wm_q<span class="ot">&lt;-</span>test3_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nb=</span><span class="fu">st_contiguity</span>(geometry), <span class="at">wt=</span><span class="fu">st_weights</span>(nb,<span class="at">style=</span><span class="st">"W"</span>),<span class="at">.before=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(wm_q,<span class="st">"data/rds/wm_qs.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>wm_q <span class="ot">&lt;-</span><span class="fu">read_rds</span>(<span class="st">"data/rds/wm_qs.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="morans-test" class="level2">
<h2 class="anchored" data-anchor-id="morans-test">4.2 Morans test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global_moran_test</span>(wm_q<span class="sc">$</span>frequency,wm_q<span class="sc">$</span>nb, wm_q<span class="sc">$</span>wt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 12.709, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.464548385      -0.003906250       0.001358733 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>bperm <span class="ot">=</span> <span class="fu">global_moran_perm</span>(wm_q<span class="sc">$</span>frequency,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>nb, </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>wt,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim=</span><span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
-0.0790354 -0.0251184 -0.0040105 -0.0003563  0.0221268  0.0968728 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>bperm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 100 

statistic = 0.46455, observed rank = 100, p-value &lt; 2.2e-16
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<section id="visualising-monte-carlo-morans-test" class="level3">
<h3 class="anchored" data-anchor-id="visualising-monte-carlo-morans-test">4.2.2 Visualising Monte-carlo moran’s test</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm<span class="sc">$</span>res, </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq=</span><span class="cn">TRUE</span>, </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks=</span><span class="dv">5</span>, </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Simulated Moran's I"</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Results of the moran’s test indicate that there is strong evidence to suggest that there is significant spatial autocorrelation the data. ( p values &lt; 2.2e-16)</strong></p>
</div>
</div>
</section>
<section id="geary-c" class="level3">
<h3 class="anchored" data-anchor-id="geary-c">4.2.3 Geary C</h3>
<p><strong>Arguments are the same as Moran (x, nb, wt, nsim)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>gperm <span class="ot">=</span> <span class="fu">global_c_perm</span>(wm_q<span class="sc">$</span>frequency,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>nb, </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>wt,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim=</span><span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.8631  0.9645  0.9993  0.9983  1.0283  1.0940 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>gperm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  x 
weights: listw 
number of simulations + 1: 100 

statistic = 0.49851, observed rank = 1, p-value = 0.01
alternative hypothesis: greater</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(gperm<span class="sc">$</span>res, <span class="at">freq=</span><span class="cn">TRUE</span>, <span class="at">breaks=</span><span class="dv">20</span>, <span class="at">xlab=</span><span class="st">"Simulated Geary c"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Results of the geary c test indicate that there is strong evidence to suggest that there is significant spatial autocorrelation the data. ( p values &lt; 0.01) - Positive spatial autocorrelation.</strong></p>
</div>
</div>
</section>
<section id="compute-moran-correlogram" class="level3">
<h3 class="anchored" data-anchor-id="compute-moran-correlogram">4.2.4 Compute Moran correlogram</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>MI_corr <span class="ot">&lt;-</span> <span class="fu">sp.correlogram</span>(wm_q<span class="sc">$</span>nb, </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                          wm_q<span class="sc">$</span>frequency, </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">order=</span><span class="dv">6</span>, </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method=</span><span class="st">"I"</span>, </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style=</span><span class="st">"W"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(MI_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>As we can see from the correlogram above, the higher the lag, the lower the Moran’s I value. This means that as the lag distance increases between different towns / villages, spatial autocorrelation weakens. Values are strongest when lag are at 1 or 2.</p>
</div>
</div>
</section>
<section id="compute-geary-c-correlogram" class="level3">
<h3 class="anchored" data-anchor-id="compute-geary-c-correlogram">4.2.5 Compute geary C correlogram</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>GC_corr <span class="ot">&lt;-</span> <span class="fu">sp.correlogram</span>(wm_q<span class="sc">$</span>nb, </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                          wm_q<span class="sc">$</span>frequency, </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">order=</span><span class="dv">6</span>, </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method=</span><span class="st">"C"</span>, </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style=</span><span class="st">"W"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(GC_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When lags are at 3 onward, Geary C values are close to if not 1, meaning total randomness. From here, we can see that there is positive spatial autocorrelation in neighbouring areas, only up two 2 lags (2 jumps). This could indicate that frequency in dengue are in clusters.</p>
</div>
</div>
</section>
</section>
</section>
<section id="local-measures-of-spatial-autocorrelation-cluster-and-outlier-analysis" class="level1">
<h1>5 Local Measures of Spatial Autocorrelation (Cluster and Outlier Analysis)</h1>
<section id="local-moran" class="level2">
<h2 class="anchored" data-anchor-id="local-moran">5.1 Local moran</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>localMoran <span class="ot">=</span> <span class="fu">local_moran</span>(wm_q<span class="sc">$</span>frequency,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>nb, </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>wt,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim=</span><span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(localMoran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           ii          eii     var_ii        z_ii        p_ii p_ii_sim
1  1.40416862 -0.079752792 0.61797960  1.88766026 0.059071574     0.02
2  0.75667997 -0.026953399 0.15370886  1.99877298 0.045632923     0.04
3  0.03486582  0.021287190 0.04930900  0.06114948 0.951240166     0.92
4 -0.21449583  0.024707315 0.08376675 -0.82647751 0.408533269     0.36
5  1.43266947  0.003819232 0.30843374  2.57279849 0.010087992     0.02
6  1.29563498  0.016778890 0.20389343  2.83217485 0.004623256     0.02
  p_folded_sim    skewness    kurtosis      mean    median     pysal
1         0.01 -0.86171486  1.15033353   Low-Low   Low-Low   Low-Low
2         0.02 -0.58973784  0.31508385   Low-Low   Low-Low   Low-Low
3         0.46  0.08794347 -0.56410065 High-High High-High High-High
4         0.18 -0.53872356  0.03141793  Low-High  Low-High  Low-High
5         0.01 -0.37730490 -0.03736517   Low-Low   Low-Low   Low-Low
6         0.01 -0.65510549  0.65735594   Low-Low   Low-Low   Low-Low</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(unique_data[<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  VILLNAME
1   青草里
2   保安里
3   赤嵌里
4   大成里
5   城北里
6   城南里</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(localMoran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           ii          eii     var_ii        z_ii        p_ii p_ii_sim
1  1.40416862 -0.079752792 0.61797960  1.88766026 0.059071574     0.02
2  0.75667997 -0.026953399 0.15370886  1.99877298 0.045632923     0.04
3  0.03486582  0.021287190 0.04930900  0.06114948 0.951240166     0.92
4 -0.21449583  0.024707315 0.08376675 -0.82647751 0.408533269     0.36
5  1.43266947  0.003819232 0.30843374  2.57279849 0.010087992     0.02
6  1.29563498  0.016778890 0.20389343  2.83217485 0.004623256     0.02
  p_folded_sim    skewness    kurtosis      mean    median     pysal
1         0.01 -0.86171486  1.15033353   Low-Low   Low-Low   Low-Low
2         0.02 -0.58973784  0.31508385   Low-Low   Low-Low   Low-Low
3         0.46  0.08794347 -0.56410065 High-High High-High High-High
4         0.18 -0.53872356  0.03141793  Low-High  Low-High  Low-High
5         0.01 -0.37730490 -0.03736517   Low-Low   Low-Low   Low-Low
6         0.01 -0.65510549  0.65735594   Low-Low   Low-Low   Low-Low</code></pre>
</div>
</div>
<section id="joining-local-moran-results-and-wm_q" class="level3">
<h3 class="anchored" data-anchor-id="joining-local-moran-results-and-wm_q">5.1.1 joining Local moran results and wm_q</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>localMoranData <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test3_sf[<span class="dv">2</span>], localMoran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>After running local moran code, it can be binded to week number as the rows are the same at 257, no need to do any fancy join.</p>
</div>
</div>
<p>Code chunk below list the content of the local Moran matrix derived by using printCoefMat - followed slides (Chap10)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span>localMoranData<span class="sc">$</span>town</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">printCoefmat</span>(<span class="fu">data.frame</span>(</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  localMoran, </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names=</span>localMoranData<span class="sc">$</span>town),</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mapping-local-moran" class="level3">
<h3 class="anchored" data-anchor-id="mapping-local-moran">5.1.2 Mapping local moran</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>localMI.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(localMoranData) <span class="sc">+</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"ii"</span>, </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local moran statistics"</span>) <span class="sc">+</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span><span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">tm_scale_bar</span>()<span class="sc">+</span><span class="fu">tm_grid</span>(<span class="at">alpha=</span><span class="fl">0.2</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>pvalue.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(localMoranData) <span class="sc">+</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"p_ii"</span>, </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-Blues"</span>, </span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Moran's I p-values"</span>) <span class="sc">+</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span><span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">tm_scale_bar</span>()<span class="sc">+</span><span class="fu">tm_grid</span>(<span class="at">alpha=</span><span class="fl">0.2</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(localMI.map, pvalue.map, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What does this tell us? For local moran statistics, those with values 1 and above, we can see that there is a strong spatial correlation in the data. Also, looking at the P values, it shows that our data is statistically significant to show that there is strong spatial correlation in those areas as well that are highlights in blue (from 0.001 onward)</strong></p>
</div>
</div>
</section>
</section>
</section>
<section id="hot-spot-and-cold-spot-area-analysis" class="level1">
<h1>6.0 Hot Spot and Cold Spot Area Analysis</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we were to use the lab example, we have to compute centroid, cut off distance, adaptive weight matrix before we can calculate Gi. However, with the use of sfdep packages, we can now do that with less steps. Source - https://sfdep.josiahparry.com/articles/understanding-emerging-hotspots</p>
</div>
</div>
<section id="calculating-the-local-gi" class="level2">
<h2 class="anchored" data-anchor-id="calculating-the-local-gi">6.1 Calculating the local Gi*</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>getis_nb <span class="ot">&lt;-</span> test3_sf <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb =</span> <span class="fu">include_self</span>(<span class="fu">st_contiguity</span>(geometry)),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt =</span> <span class="fu">st_weights</span>(nb)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>gistar <span class="ot">&lt;-</span> getis_nb <span class="sc">|&gt;</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">gi_star =</span> <span class="fu">local_gstar_perm</span>(frequency, nb, wt, <span class="at">nsim =</span> <span class="dv">199</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(gi_star)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>gistar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 257 features and 8 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 120.0627 ymin: 22.89401 xmax: 120.2925 ymax: 23.09144
Geodetic CRS:  TWD97
# A tibble: 257 × 9
   gi_star    e_gi      var_gi p_value   p_sim p_folded_sim skewness kurtosis
     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1  -2.35  0.00292 0.00000177  -2.00   0.0451          0.01    0.005    0.522
 2  -2.07  0.00354 0.00000152  -1.82   0.0687          0.02    0.01     0.798
 3   0.365 0.00420 0.000000974  0.0693 0.945           0.93    0.465    0.334
 4   0.363 0.00365 0.00000149   0.543  0.587           0.59    0.295    0.484
 5  -2.65  0.00305 0.00000164  -2.20   0.0276          0.01    0.005    0.606
 6  -3.17  0.00343 0.00000125  -2.88   0.00397         0.01    0.005    0.522
 7  -1.25  0.00357 0.00000170  -1.07   0.284           0.24    0.12     0.819
 8  -0.280 0.00374 0.000000753 -0.120  0.905           0.96    0.48     0.457
 9   1.53  0.00430 0.00000163   1.18   0.236           0.28    0.14     0.651
10  -1.47  0.00376 0.00000100  -1.57   0.116           0.08    0.04     0.515
# ℹ 247 more rows
# ℹ 1 more variable: geometry &lt;POLYGON [°]&gt;</code></pre>
</div>
</div>
</section>
<section id="mapping-local-gi" class="level2">
<h2 class="anchored" data-anchor-id="mapping-local-gi">6.2 Mapping local Gi*</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>gistar <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">case_when</span>(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    p_folded_sim <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    p_folded_sim <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> gi_star <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    p_folded_sim <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> gi_star <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High"</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> cluster)) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">lwd =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"High"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"Blue"</span>, </span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>As expected, high clusters in the center region of tainan but weirdly, alot of low clusters, all on the outskirts.</p>
</div>
</div>
</section>
</section>
<section id="space-time-and-space-cubes" class="level1">
<h1>7 Space time and space cubes</h1>
<p>Source- https://sfdep.josiahparry.com/articles/spacetime-s3</p>
<section id="filtering-data-that-we-need" class="level2">
<h2 class="anchored" data-anchor-id="filtering-data-that-we-need">7.1 Filtering data that we need</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>test4_sf <span class="ot">&lt;-</span> test4_sf <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(town,week_number, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>test5_sf <span class="ot">&lt;-</span> test4_sf<span class="sc">%&gt;%</span> <span class="fu">select</span>(week_number,town,frequency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-a-space-time-object" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-space-time-object">7.2 Creating a space time object</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>spt <span class="ot">&lt;-</span> <span class="fu">as_spacetime</span>(test5_sf, <span class="st">"town"</span>, <span class="st">"week_number"</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">activate</span>(spt, <span class="st">"data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="spacetime-contexts" class="level3">
<h3 class="anchored" data-anchor-id="spacetime-contexts">7.2.1 Spacetime Contexts</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>spt <span class="sc">|&gt;</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">"geometry"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 257 features and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 120.0627 ymin: 22.89401 xmax: 120.2925 ymax: 23.09144
Geodetic CRS:  TWD97
First 10 features:
                town                       geometry
1   D06 Qingcao Vil. POLYGON ((120.1176 23.08387...
2    D32 Bao'an Vil. POLYGON ((120.2304 22.93544...
3   D08 Chihkan Vil. POLYGON ((120.2012 22.99966...
4   D02 Dacheng Vil. POLYGON ((120.1985 22.98147...
5  D06 Chengbei Vil. POLYGON ((120.1292 23.06512...
6  D06 Chengnan Vil. POLYGON ((120.1246 23.06904...
7     D08 Fahua Vil. POLYGON ((120.2094 22.98452...
8    D06 Hainan Vil. POLYGON ((120.175 23.02218,...
9    D06 Guo'an Vil. POLYGON ((120.1866 23.02766...
10    D06 Xixin Vil. POLYGON ((120.1834 23.06086...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_spacetime_cube</span>(spt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>spt_complete <span class="ot">&lt;-</span> <span class="fu">complete_spacetime_cube</span>(spt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="replacing-all-n.a-values-with-0" class="level3">
<h3 class="anchored" data-anchor-id="replacing-all-n.a-values-with-0">7.3.2 Replacing all N.A values with 0</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>spt_complete <span class="ot">&lt;-</span> <span class="fu">complete_spacetime_cube</span>(spt)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>spt_complete <span class="ot">&lt;-</span> spt_complete <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">frequency =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(frequency), <span class="dv">0</span>, frequency))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I kept running into an error and i think its due to NA values in the frequency column. After i replaced the NA values, i didnt not run into that error anymore</p>
</div>
</div>
</section>
</section>
<section id="emerging-hotspot-analysis" class="level2">
<h2 class="anchored" data-anchor-id="emerging-hotspot-analysis">7.4 Emerging hotspot analysis</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>emerging_hotspot<span class="ot">&lt;-</span> <span class="fu">emerging_hotspot_analysis</span>(spt_complete, <span class="st">"frequency"</span>, <span class="at">threshold =</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(emerging_hotspot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           location         tau      p_value      classification
1  D06 Qingcao Vil.  0.56842101 0.0005174875  oscilating hotspot
2   D32 Bao'an Vil. -0.08421052 0.6264962554  oscilating hotspot
3  D08 Chihkan Vil. -0.54736835 0.0008324861  oscilating hotspot
4  D02 Dacheng Vil.  0.03157894 0.8711314201 oscilating coldspot
5 D06 Chengbei Vil. -0.12631577 0.4555354118 oscilating coldspot
6 D06 Chengnan Vil. -0.19999999 0.2299690843    sporadic hotspot</code></pre>
</div>
</div>
</section>
<section id="emerging-hotspot-analysis-1" class="level2">
<h2 class="anchored" data-anchor-id="emerging-hotspot-analysis-1">7.5 Emerging hotspot analysis</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Source - https://is415-gaa-tskam.netlify.app/in-class_ex/in-class_ex05/in-class_ex05-ehsa</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>ehsa <span class="ot">&lt;-</span> <span class="fu">emerging_hotspot_analysis</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> spt_complete, </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.var =</span> <span class="st">"frequency"</span>, </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">1</span>, </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">99</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(ehsa,<span class="st">"data/rds/ehsa.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>ehsa <span class="ot">&lt;-</span><span class="fu">read_rds</span>(<span class="st">"data/rds/ehsa.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="visualising-the-distribution-of-ehsa-classes" class="level3">
<h3 class="anchored" data-anchor-id="visualising-the-distribution-of-ehsa-classes">7.5.1 Visualising the distribution of EHSA classes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ehsa,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> classification)) <span class="sc">+</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="visualising-ehsa" class="level2">
<h2 class="anchored" data-anchor-id="visualising-ehsa">7.6 Visualising EHSA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>dengue_ehsa <span class="ot">&lt;-</span> test3_sf <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ehsa,</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(town <span class="sc">==</span> location))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>ehsa_sig <span class="ot">&lt;-</span> dengue_ehsa  <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dengue_ehsa) <span class="sc">+</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(ehsa_sig) <span class="sc">+</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"classification"</span>) <span class="sc">+</span> </span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="take_home_Ex02_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Looking at the map and the graph, majority are oscilating hotspot (highlighted in orange) and also, oscilating hotspots means there are the ones with more frequent spikes in numbers, meaning we should focus more of our attention there if we are allocating resources such as vaccines / manpower to those areas to treat dengue.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Conclusion: Through this assignment, i am able to successfully identify patterns in the given area in tainan and also segment them accordingly to gather insights about clusters forming. I made use of Local and global spacial autocorrelation methods to find evidence of non-randomness in dengue spreads and finally space time cube method to see how through time, hotspots/ coldspots are formed</p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>